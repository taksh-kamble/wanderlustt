<% layout('layouts/boilerplate') -%>
<body class="bg-light d-flex flex-column min-vh-100">

  <div class="container py-5 text-center flex-grow-1">

    <!-- Title -->
    <h3 class="mb-4 fw-bold" style="font-size: 2rem;">
      <%= reqListing.title %>
    </h3>

    <!-- Image -->
    <img 
      src="<%= reqListing.image %>" 
      alt="Listing Image" 
      class="img-fluid rounded mb-4" 
      style="max-width: 450px; height: 450px; object-fit: cover;"
    >

    <!-- Details -->
    <div class="mx-auto mb-4 p-3 bg-white rounded shadow-sm text-start" style="max-width: 500px; font-size: 1.05rem; line-height: 1.6;">
      <p><b>Description:</b> <%= reqListing.description %></p>
      <p><b>Price:</b> &#8377;<%= reqListing.price %></p>
      <p><b>Location:</b> <%= reqListing.location %></p>
      <p><b>Country:</b> <%= reqListing.country %></p>
    </div>

    <!-- Buttons -->
    <div class="d-flex justify-content-center mb-5 gap-2">
      <a href="/listings/<%= reqListing._id %>/edit" class="btn btn-warning px-4">Edit</a>
      <form method="POST" action="/listings/<%= reqListing._id %>?_method=DELETE">
        <button type="submit" class="btn btn-danger px-4">Delete</button>
      </form>
    </div>

    <!-- Review Section -->
    <div class="mx-auto p-4 bg-white rounded shadow-sm mb-5" style="max-width: 600px;">
      <h4 class="mb-4">Leave a Review</h4>
      <form class="needs-validation" action="/listings/<%= reqListing._id %>/reviews" method="POST" novalidate>
        
        <div class="mb-3">
          <label for="rating" class="form-label"><b>Rating:</b> <span id="ratingValue">3</span></label>
          <input type="range" class="form-range" min="1" max="5" id="rating" name="review[rating]" value="3" 
            oninput="document.getElementById('ratingValue').innerText = this.value;">
        </div>

        <div class="mb-3">
          <label for="comment" class="form-label"><b>Comment:</b></label>
          <textarea name="review[comment]" id="comment" cols="30" rows="4" class="form-control" placeholder="Write your review here..." required></textarea>
          <div class="invalid-feedback">Please write a comment.</div>
        </div>

        <button type="submit" class="btn btn-primary w-100">Submit Review</button>
      </form>
    </div>

    <hr class="my-5">

    <!-- All Reviews as Cards -->

  <!-- All Reviews Section -->
  <div class="mx-auto mb-5" style="max-width: 700px;">
    <h4 class="mb-4 text-center fw-bold">All Reviews</h4>

    <% if (reqListing.reviews.length === 0) { %>
      <p class="text-muted text-center">No reviews yet. Be the first to leave one!</p>
    <% } else { %>
      <div class="d-flex flex-column gap-3">
        <% for (let review of reqListing.reviews) { %>
          <div class="card border-0 shadow-sm rounded-3">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <div>
                  <h6 class="fw-semibold mb-1 text-primary">
                    <%= review.username || "Anonymous" %>
                  </h6>
                  <small class="text-muted">
                    <%= new Date(review.createdAt).toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric' }) %>
                  </small>
                </div>
                <div class="text-end">
                  <span class="badge bg-warning text-dark fs-6"><%= review.rating %> ‚≠ê</span>
                </div>
              </div>
              <p class="mb-3 text-secondary"><%= review.comment %></p>
              <form method="POST" action="/listings/<%= reqListing._id %>/reviews/<%= review._id %>?_method=DELETE" class="text-end">
                <button type="submit" class="btn btn-sm btn-outline-danger">
                  <i class="bi bi-trash"></i> Delete
                </button>
              </form>
            </div>
          </div>
        <% } %>
      </div>
    <% } %>
  </div>

    
</body>
